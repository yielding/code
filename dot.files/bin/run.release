#!/bin/sh

# Rust í”„ë¡œì íŠ¸ ê°ì§€ (Cargo.toml ì¡´ì¬ ì—¬ë¶€)
if [ -f "Cargo.toml" ]; then
  echo "ğŸ¦€ Rust í”„ë¡œì íŠ¸ ê°ì§€ë¨"
  cargo run --release "$@"
  exit $?
fi

BUILD_DIR="build/release"

# ë¹Œë“œ ë””ë ‰í† ë¦¬ í™•ì¸
if [ ! -d "$BUILD_DIR" ]; then
  echo "Error: $BUILD_DIR ë””ë ‰í† ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤."
  echo "ë¨¼ì € make.releaseë¥¼ ì‹¤í–‰í•˜ì„¸ìš”."
  exit 1
fi

# ì‹¤í–‰ íŒŒì¼ ì°¾ê¸° (CMakeLists.txtì—ì„œ í”„ë¡œì íŠ¸ ì´ë¦„ ì¶”ì¶œ)
if [ -f "CMakeLists.txt" ]; then
  EXECUTABLE=$(grep -m1 "^project" CMakeLists.txt | sed -E 's/project[[:space:]]*\([[:space:]]*([^[:space:])]+).*/\1/')
fi

# ì‹¤í–‰ íŒŒì¼ ê²½ë¡œ
EXEC_PATH="$BUILD_DIR/$EXECUTABLE"

if [ ! -x "$EXEC_PATH" ]; then
  echo "Error: ì‹¤í–‰ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: $EXEC_PATH"
  echo "ë¹Œë“œê°€ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”."
  exit 1
fi

echo "Running: $EXEC_PATH $@"
echo "----------------------------------------"
"$EXEC_PATH" "$@"
