#!/bin/sh

# Rust í”„ë¡œì íŠ¸ ê°ì§€ (Cargo.toml ì¡´ì¬ ì—¬ë¶€)
if [ -f "Cargo.toml" ]; then
  echo "ğŸ¦€ Rust í”„ë¡œì íŠ¸ ê°ì§€ë¨"
  cargo build
  exit $?
fi

# ê¸°ë³¸ê°’: clang++
CXX_COMPILER="clang++"

# ì¸ì ì²˜ë¦¬
if [ "$1" = "clang" ]; then
  CXX_COMPILER="clang++"
elif [ "$1" = "g++" ]; then
  CXX_COMPILER="g++-15"
elif [ -n "$1" ]; then
  echo "ì§€ì›í•˜ì§€ ì•ŠëŠ” ì¸ìì…ë‹ˆë‹¤: $1"
  echo "ì‚¬ìš©ë²•: $0 [clang|g++]"
  exit 1
fi

# CXX í™˜ê²½ë³€ìˆ˜ ì„¤ì • í›„ CMake ì‹¤í–‰
echo "ğŸ”§ ì»´íŒŒì¼ëŸ¬: $CXX_COMPILER"
cmake -S . -B build/debug \
  -DCMAKE_BUILD_TYPE=Debug \
  -DCMAKE_CXX_COMPILER=$(which "$CXX_COMPILER") \
  -DCMAKE_INSTALL_PREFIX="${PWD}/install"

# ë¹Œë“œ
cmake --build build/debug -- -j$(nproc)